@using CoreArchV2.Core.Enum

<div id="HgsChartModal" class="modal fade" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-violet-300">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h6 class="modal-title">Hgs Rapor</h6>
            </div>
            <div class="modal-body">
                <!-- Header Dashboard -->
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="panel panel-body bg-orange-300">
                                        <div class="media no-margin">
                                            <div class="media-body">
                                                <h3 class="no-margin" id="totalHgsAmount" style="font-size: 15px;">---</h3>
                                                <span class="text-size-mini">Toplam Tutar</span>
                                            </div>
                                            <div class="media-right media-middle">
                                                <i style="font-size: 37px;" class="fa fa-try opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="panel panel-body bg-slate-300">
                                        <div class="media no-margin">
                                            <div class="media-body">
                                                <h3 class="no-margin" id="hgsVehicleCount" style="font-size: 15px;">---</h3>
                                                <span class="text-size-mini">Araç Sayısı</span>
                                            </div>

                                            <div class="media-right media-middle">
                                                <i style="font-size: 37px;" class="fa fa-car opacity-75"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Dashboard -->
                <div class="form-group" style="margin-top: -20px;">
                    <div class="row">
                        <div id="hgs_FormId" class="col-md-12">
                            <div class="col-md-3">
                                <div class="row">
                                    <input id="StartDateHgs" table-param="StartDate" class="form-control" type="date" autocomplete="off">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="row">
                                    <input id="EndDateHgs" table-param="EndDate" class="form-control" type="date" autocomplete="off">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="row">
                                    <select id="TypeId_Hgs"
                                            class="select-search"
                                            table-param="TypeId"
                                            table-id="comboBox-TypeId_Hgs"
                                            table-model-url="/Combo/HgsTypeList"
                                            table-tool-type="comboBox"
                                            tabindex="3"
                                            data-option-label="İşlem Tipi Seçiniz">
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="row">
                                    <button type="button" style="width: 100%; height: 35px;" class="btn bg-success-300 btn-xs" onclick="exportExcelHgs()"><i class="icon-file-excel"></i> Excel</button>
                                </div>
                            </div>
                            <div class="col-md-1">
                                <div class="row">
                                    <button type="button" style="width: 100%; height: 35px;" class="btn bg-teal-300 btn-xs" onclick="loadDataChart(true)"><i class="icon-search4"></i> Filtrele</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-responsive">
                                <div class="panel panel-flat">
                                    <div id="chartHgs" style="height: 450px; width: 100%;background-color: #333333;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" class="btn btn-danger full-width" onclick="$('#HgsChartModal').modal('hide')"><i class="fa fa-times"></i> Ekranı Kapat</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<script>
    function exportExcelHgs() {
        $('#loadingEffect').css("display", "flex");
        var model = {
            StartDate: $('#StartDateHgs').val(),
            EndDate: $('#EndDateHgs').val(),
            TypeId: $('#TypeId_Hgs').val()
        };
        window.location = insertParam('/Export/HgsInfo', model);
        setTimeout(function () {
            $('#loadingEffect').css("display", "none");
        }, 3000);
    }

    function hgsChart() {
        loadDataChart();
        $('#HgsChartModal').modal("show");
    }

    function loadDataChart() {
        var model = FormGetAllValue("#hgs_FormId [table-param]");
        sendAjxForm(model, "/Report/GetHgsReport", function (data) {
            if (data != null) {
                $('#totalHgsAmount').text(formatMoney(data.Amount, 2) + " ₺");
                $('#hgsVehicleCount').text(data.PlateCount);
                chart_hgs(data.ChartPlate);
            }
            else {
                chart_hgs(null);
                ShowMessage("info", "Bilgi", "Hgs kaydı bulunamadı");
            }
        }, "GET");
    }

    function chart_hgs(data) {
        am4core.useTheme(am4themes_dark);
        am4core.useTheme(am4themes_animated);
        var chart = am4core.create("chartHgs", am4charts.XYChart3D);
        chart.data = data;

        var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
        categoryAxis.dataFields.category = "Plate";
        categoryAxis.renderer.grid.template.location = 0;
        categoryAxis.renderer.minGridDistance = 30;
        categoryAxis.renderer.labels.template.horizontalCenter = "right";
        categoryAxis.renderer.labels.template.verticalCenter = "middle";
        categoryAxis.tooltip.disabled = false;
        categoryAxis.renderer.minHeight = 110;
        categoryAxis.renderer.labels.template.rotation = -50;
        categoryAxis.renderer.labels.template.fontFamily = "robotic";

        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
        valueAxis.title.text = "Araç Bazlı Hgs Yükleme";
        valueAxis.title.fontWeight = "bold";
        valueAxis.min = 0;

        // Create series
        var series = chart.series.push(new am4charts.ColumnSeries3D());
        series.dataFields.valueY = "Amount";
        series.dataFields.categoryX = "Plate";
        series.tooltipText = "Tutar: [bold]{valueY}[/] ₺";
        series.columns.template.fillOpacity = .8;
        series.columns.template.fill = am4core.color("#FFB74D");

        chart.cursor = new am4charts.XYCursor();
        chart.cursor.lineX.strokeOpacity = 0;
        chart.cursor.lineY.strokeOpacity = 0;
    }
</script>