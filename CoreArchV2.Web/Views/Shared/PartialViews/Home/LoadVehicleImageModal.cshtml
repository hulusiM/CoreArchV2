<div id="VehicleLoadImage_Modal" class="modal fade" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success-300">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h5 id="VehicleImageModalTitleId" class="modal-title text-center">Araç Fotoğraf Yükleme Listesi</h5>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-flat">
                            <div class="panel-body">
                                <div id="ImageLoadForm" class="form-group">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <select id="ImageParentUnitId"
                                                    tabindex="1"
                                                    table-param="ParentUnitId"
                                                    onchange="changeImageParentUnitId()"
                                                    class="select-search"
                                                    table-id="comboBox-ImageParentUnitId"
                                                    table-model-url="/Combo/GetUnitJustParentCmbx"
                                                    table-tool-type="comboBox"
                                                    data-option-label="Müdürlük Seçiniz">
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select id="ImageUnitId"
                                                    tabindex="2"
                                                    table-param="UnitId"
                                                    class="select-search"
                                                    table-id="comboBox-ImageUnitId"
                                                    table-model-url=""
                                                    table-tool-type="comboBox"
                                                    data-option-label="Proje Seçiniz">
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <input id="ImageTransactionDate" table-param="TransactionDate" tabindex="4" class="form-control" type="month" autocomplete="off">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" style="width: 100%; height: 35px;" class="btn bg-success-300 btn-xs" onclick="ImageLoadExcel()"><i class="icon-file-excel"></i> Excel</button>
                                        </div>
                                        <div class="col-md-2">
                                            <button type="button" style="width: 100%; height: 35px;" class="btn bg-teal-300 btn-xs" onclick="loadImageVehicle(true)"><i class="icon-search4"></i> Filtrele</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive genericDatatables" style="font-size: 11px; height: 70vh; overflow: scroll;">
                                    <table class="table-striped table-hover table-bordered table datatable-basic"
                                           id="dataTableImage"
                                           table-id="dataTable-ImageVehicle">
                                        <thead>
                                            <tr class="filters">
                                                <th style="text-align: center; width: 1%;">No</th>
                                                <th data-value="Plate2" style="text-align: center;">
                                                    Plaka
                                                </th>
                                                <th data-value="NameSurname" style="text-align: center;">
                                                    Yükleyen Kullanıcı
                                                </th>
                                                <th data-value="DebitCreatedDate" data-type="date" style="text-align: center;">
                                                    Yükleme Tarihi
                                                </th>
                                                <th data-value="DebitNameSurname" style="text-align: center;">
                                                    Zimmetli Adı Soyadı
                                                </th>
                                                <th data-value="UnitName" style="text-align: center;">
                                                    Müdürlük/Proje
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tbodyVehicleImage"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: -25px;">
                <div class="col-md-7"></div>
                <div class="col-md-5">
                    <button type="button" class="text-bla btn bg-danger-600" data-dismiss="modal" style="width: 100%;">Ekranı Kapat</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function changeImageParentUnitId() {
        var parentUnitId = $('#ImageParentUnitId').val();

        sendAjxForm({ parentId: parentUnitId },
            "/Combo/GetUnitChildCmbx",
            function (e) {
                funcCustomComboBox(e, "ImageUnitId", "Proje Seçiniz");
            }, "GET");
    }

    function loadImageVehicle(filter) {
        $('#tbodyVehicleImage tr').remove();
        var model = {}
        if (filter) {
            model = {
                ParentUnitId: $("#ImageParentUnitId").val(),
                UnitId: $("#ImageUnitId").val(),
                TransactionDate: $("#ImageTransactionDate").val(),
            }
        }

        sendAjxForm(model, "/Vehicle/GetNotLoadVehicleImage", function (e) {

            if (e.length > 0) {
                $('#VehicleImageModalTitleId').html("Araç Fotoğraf Yükleme Listesi" + e[0].TempPlateNo);
                funcCustomDataTable(e, "dataTable-ImageVehicle");
                $('#VehicleLoadImage_Modal').modal("show");
            } else
                ShowMessage("info", "Bilgi", "Kayıt Bulunamadı");

        }, "GET");
    }

    function ImageLoadExcel() {
        $('#loadingEffect').css("display", "flex");
        var model = FormGetAllValue("#ImageLoadForm [table-param]");
        if (model != null)
            window.location = insertParam('/Export/VehicleImageLoadInfo', model);
        setTimeout(function () {
            $('#loadingEffect').css("display", "none");
        }, 5000);
    }

</script>